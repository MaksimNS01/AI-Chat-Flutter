# AIChatFlutter - Чат-приложение с ИИ

AIChatFlutter - это мультиплатформенное приложение для общения с искусственным интеллектом, разработанное с использованием Flutter. Приложение поддерживает работу как с OpenRouter.ai, так и с VseGPT.ru, предоставляя гибкие возможности для взаимодействия с различными языковыми моделями.

## Поддержка API

### OpenRouter.ai
- Баланс отображается в долларах ($)
- Стоимость сообщений рассчитывается в долларах за миллион токенов
- Широкий выбор языковых моделей от разных провайдеров
- Единый API для доступа к различным моделям

### VseGPT.ru
- Баланс отображается в рублях (₽)
- Стоимость сообщений рассчитывается в рублях за тысячу токенов
- Доступ к популярным моделям с оплатой в рублях
- Оптимизировано для пользователей из России

## Структура проекта

Основные директории и файлы:

- `lib/` - Основной код приложения
  - `main.dart` - Точка входа в приложение
  - `api/` - Модули для работы с API
    - `openrouter_client.dart` - Универсальный клиент для работы с OpenRouter и VseGPT
  - `models/` - Модели данных
    - `message.dart` - Модель сообщения с поддержкой токенов и стоимости
  - `providers/` - State management
    - `chat_provider.dart` - Провайдер для управления состоянием чата
  - `services/` - Сервисы
    - `database_service.dart` - Сервис для работы с локальной базой данных
    - `analytics_service.dart` - Сервис для сбора и анализа статистики
  - `screens/` - Экраны приложения
    - `chat_screen.dart` - Основной экран чата
    - `settings_screen.dart` - Экран настроек API и провайдера
    - `token_stats_screen.dart` - Экран статистики использования токенов
    - `cost_chart_screen.dart` - Экран визуализации расходов
    - `pin_code_screen.dart` - Экран для аутентификации по PIN-коду
- `android/`, `ios/`, `windows/`, `linux/` - Платформо-зависимые конфигурации
- `assets/` - Ресурсы приложения
- `pubspec.yaml` - Зависимости проекта

## Основные модули

### ChatProvider
- Управление состоянием чата и историей сообщений
- Взаимодействие с API (OpenRouter/VseGPT)
- Отслеживание баланса
- Управление моделями
- Загрузка статистики для экрана расходов

### Message
- Хранение текста сообщений
- Учет использованных токенов
- Расчет стоимости сообщений
- Метаданные (временные метки, модель)

### OpenRouterClient
- Унифицированный интерфейс для работы с API
- Автоматическое определение провайдера (OpenRouter/VseGPT)
- Форматирование цен в соответствии с провайдером
- Обработка ошибок и повторные попытки

### DatabaseService
- Локальное хранение истории сообщений и метаданных (включая модели для графика расходов)
- Кэширование данных
- Экспорт истории
- Подготовка агрегированных данных для статистики расходов

### AnalyticsService
- Сбор статистики использования (токены, сообщения)
- Анализ эффективности моделей
- Отслеживание времени ответа

## Функциональность приложения

### Основные возможности
- Обмен сообщениями с различными языковыми моделями
- Выбор модели из доступного списка
- Отображение баланса в соответствующей валюте ($/₽)
- Подсчет стоимости каждого сообщения
- Отслеживание использования токенов

### Управление чатом
- Сохранение истории сообщений
- Экспорт истории в JSON
- Копирование сообщений в буфер обмена
- Очистка истории
- Кнопка быстрой прокрутки вниз
- Автоматическая прокрутка при получении новых сообщений
- Автоматическая прокрутка после успешной аутентификации по PIN-коду

### Статистика и Аналитика

#### Раздел "Токены" (`TokenStatsScreen`)
- Отображение статистики использования токенов по каждой модели.
- Суммарное количество токенов и сообщений для модели.

#### Раздел "Расходы" (`CostChartScreen`)
- Визуализация ежедневных расходов в виде столбчатой диаграммы.
- Возможность выбора периода для отображения данных (7, 30, 90 дней).
- Переключение типа отображаемых на графике данных: Стоимость, Токены, Сообщения.
- При нажатии на столбец графика отображается диалог с детализацией за выбранный день (стоимость, токены, сообщения, использованные модели).

### Настройки (`SettingsScreen`)
- Выбор API провайдера (OpenRouter.ai / VseGPT.ru).
- Ввод и сохранение API ключа.
- Настройка базового URL для API (если отличается от стандартного).
- Установка и изменение PIN-кода для доступа к приложению.
- Включение/выключение аутентификации по PIN-коду.

### Безопасность
- Аутентификация по PIN-коду для защиты доступа к приложению (опционально).

### Интерфейс
- Темный режим
- Адаптивный дизайн
- Поддержка русского и английского языков
- Информативные уведомления

### Технические особенности
- Кроссплатформенность (Android, iOS, Windows, Linux)
- Локальное хранение данных
- Оффлайн доступ к истории и статистике
- Обработка ошибок сети

## Начало работы

1. Клонируйте репозиторий
2. Создайте файл `.env` на основе `.env.example`.
3. Добавьте необхоидмые параметры в `.env`.
4. Следуйте инструкциям в [INSTALL.md](INSTALL.md) для установки зависимостей и запуска.

## Конфигурация

Основные настройки (API ключ, провайдер) доступны через интерфейс приложения в разделе "Настройки".
Файл `.env` может использоваться для первоначальной конфигурации или для задания значений по умолчанию:
- `BASE_URL` - URL API (https://openrouter.ai/api/v1 или https://api.vsetgpt.ru/v1)
- `MAX_TOKENS` - Максимальное количество токенов для ответа (влияет на запросы к API)
- `TEMPERATURE` - Температура генерации (0.0 - 1.0) (влияет на запросы к API)

## Лицензия
Проект распространяется под MIT License.  
